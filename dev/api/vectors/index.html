<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Vectors · SafePETSc.jl</title><meta name="title" content="Vectors · SafePETSc.jl"/><meta property="og:title" content="Vectors · SafePETSc.jl"/><meta property="twitter:title" content="Vectors · SafePETSc.jl"/><meta name="description" content="Documentation for SafePETSc.jl."/><meta property="og:description" content="Documentation for SafePETSc.jl."/><meta property="twitter:description" content="Documentation for SafePETSc.jl."/><meta property="og:url" content="https://sloisel.github.io/SafePETSc.jl/api/vectors/"/><meta property="twitter:url" content="https://sloisel.github.io/SafePETSc.jl/api/vectors/"/><link rel="canonical" href="https://sloisel.github.io/SafePETSc.jl/api/vectors/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">SafePETSc.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../getting_started/">Getting Started</a></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../../guide/distributed_refs/">Distributed Reference Management</a></li><li><a class="tocitem" href="../../guide/vectors/">Vectors</a></li><li><a class="tocitem" href="../../guide/matrices/">Matrices</a></li><li><a class="tocitem" href="../../guide/solvers/">Linear Solvers</a></li></ul></li><li><span class="tocitem">API Reference</span><ul><li><a class="tocitem" href="../safempi/">SafeMPI</a></li><li class="is-active"><a class="tocitem" href>Vectors</a><ul class="internal"><li><a class="tocitem" href="#Type"><span>Type</span></a></li><li><a class="tocitem" href="#Constructors"><span>Constructors</span></a></li><li><a class="tocitem" href="#Helper-Constructors"><span>Helper Constructors</span></a></li><li><a class="tocitem" href="#Partitioning"><span>Partitioning</span></a></li><li><a class="tocitem" href="#Operations"><span>Operations</span></a></li></ul></li><li><a class="tocitem" href="../matrices/">Matrices</a></li><li><a class="tocitem" href="../solvers/">Solvers</a></li></ul></li><li><a class="tocitem" href="../../developer/">Developer Guide</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">API Reference</a></li><li class="is-active"><a href>Vectors</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Vectors</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Vectors-API-Reference"><a class="docs-heading-anchor" href="#Vectors-API-Reference">Vectors API Reference</a><a id="Vectors-API-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#Vectors-API-Reference" title="Permalink"></a></h1><p>Distributed vector operations in SafePETSc.</p><h2 id="Type"><a class="docs-heading-anchor" href="#Type">Type</a><a id="Type-1"></a><a class="docs-heading-anchor-permalink" href="#Type" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SafePETSc.Vec" href="#SafePETSc.Vec"><code>SafePETSc.Vec</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Vec{T}</code></pre><p>A distributed PETSc vector with element type <code>T</code>, managed by SafePETSc&#39;s reference counting system.</p><p><code>Vec{T}</code> is a type alias for <code>DRef{_Vec{T}}</code> and is released collectively when all ranks release their references. By default, released PETSc vectors are returned to an internal pool for reuse rather than destroyed immediately. To force destruction instead of pooling, set <code>ENABLE_VEC_POOL[] = false</code>, or call <code>clear_vec_pool!()</code> to free pooled vectors.</p><p><strong>Construction</strong></p><p>Use <a href="#SafePETSc.Vec_uniform"><code>Vec_uniform</code></a> or <a href="#SafePETSc.Vec_sum"><code>Vec_sum</code></a> to create distributed vectors:</p><pre><code class="language-julia hljs"># Create from uniform data (same on all ranks)
v = Vec_uniform([1.0, 2.0, 3.0, 4.0])

# Create from sparse contributions (summed across ranks)
using SparseArrays
v = Vec_sum(sparsevec([1, 3], [1.0, 3.0], 4))</code></pre><p><strong>Operations</strong></p><p>Vectors support standard arithmetic operations via broadcasting:</p><pre><code class="language-julia hljs">y = x .+ 1.0        # Element-wise addition
y .= 2.0 .* x       # In-place scaling
z = x .+ y          # Vector addition</code></pre><p>Matrix-vector multiplication:</p><pre><code class="language-julia hljs">y = A * x           # Matrix-vector product
LinearAlgebra.mul!(y, A, x)  # In-place version</code></pre><p>See also: <a href="#SafePETSc.Vec_uniform"><code>Vec_uniform</code></a>, <a href="#SafePETSc.Vec_sum"><code>Vec_sum</code></a>, <a href="../matrices/#SafePETSc.Mat"><code>Mat</code></a>, <a href="#SafePETSc.zeros_like"><code>zeros_like</code></a>, <a href="@ref"><code>ENABLE_VEC_POOL</code></a>, <a href="@ref"><code>clear_vec_pool!</code></a></p></div></section></article><h2 id="Constructors"><a class="docs-heading-anchor" href="#Constructors">Constructors</a><a id="Constructors-1"></a><a class="docs-heading-anchor-permalink" href="#Constructors" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SafePETSc.Vec_uniform" href="#SafePETSc.Vec_uniform"><code>SafePETSc.Vec_uniform</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Vec_uniform(v::Vector{T}; row_partition=default_row_partition(length(v), MPI.Comm_size(MPI.COMM_WORLD)), prefix=&quot;&quot;) -&gt; Vec{T}</code></pre><p>Create a distributed PETSc vector from a Julia vector, asserting uniform distribution across ranks (on MPI.COMM_WORLD).</p><ul><li><code>v::Vector{T}</code> must be identical on all ranks (<code>mpi_uniform</code>).</li><li><code>row_partition</code> is a Vector{Int} of length <code>nranks+1</code> with 1-based inclusive starts.</li><li><code>prefix</code> sets <code>VecSetOptionsPrefix</code> for PETSc options.</li><li>Returns a <code>Vec{T}</code> (aka <code>DRef{_Vec{T}}</code>) managed collectively; by default vectors are returned to a reuse pool when released, not immediately destroyed. Use <code>ENABLE_VEC_POOL[] = false</code> or <code>clear_vec_pool!()</code> to force destruction.</li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SafePETSc.Vec_sum" href="#SafePETSc.Vec_sum"><code>SafePETSc.Vec_sum</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Vec_sum(v::SparseVector{T}; row_partition=default_row_partition(length(v), MPI.Comm_size(MPI.COMM_WORLD)), prefix=&quot;&quot;, own_rank_only=false) -&gt; Vec{T}</code></pre><p>Create a distributed PETSc vector by summing sparse vectors across ranks (on MPI.COMM_WORLD).</p><ul><li><code>v::SparseVector{T}</code> can differ across ranks; nonzeros are summed across all ranks.</li><li><code>row_partition</code> is a Vector{Int} of length <code>nranks+1</code> with 1-based inclusive starts.</li><li><code>prefix</code> sets <code>VecSetOptionsPrefix</code> for PETSc options.</li><li><code>own_rank_only::Bool</code> (default=false): if true, asserts that all nonzero indices fall within this rank&#39;s row partition.</li><li>Returns a <code>Vec{T}</code> managed collectively; by default vectors are returned to a reuse pool when released, not immediately destroyed. Use <code>ENABLE_VEC_POOL[] = false</code> or <code>clear_vec_pool!()</code> to force destruction.</li></ul><p>Uses <code>VecSetValues</code> with <code>ADD_VALUES</code> to sum contributions across ranks.</p></div></section></article><h2 id="Helper-Constructors"><a class="docs-heading-anchor" href="#Helper-Constructors">Helper Constructors</a><a id="Helper-Constructors-1"></a><a class="docs-heading-anchor-permalink" href="#Helper-Constructors" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SafePETSc.zeros_like" href="#SafePETSc.zeros_like"><code>SafePETSc.zeros_like</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">zeros_like(x::Vec{T}; T2::Type{S}=T, prefix::String=x.obj.prefix) -&gt; Vec{S}</code></pre><p>Create a new distributed vector with the same size and partition as <code>x</code>, filled with zeros.</p><p><strong>Arguments</strong></p><ul><li><code>x</code>: Template vector to match size and partition</li><li><code>T2</code>: Element type of the result (defaults to same type as <code>x</code>)</li><li><code>prefix</code>: PETSc options prefix (defaults to same prefix as <code>x</code>)</li></ul><p>See also: <a href="#SafePETSc.ones_like"><code>ones_like</code></a>, <a href="#SafePETSc.fill_like"><code>fill_like</code></a>, <a href="#SafePETSc.Vec_uniform"><code>Vec_uniform</code></a></p></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SafePETSc.ones_like" href="#SafePETSc.ones_like"><code>SafePETSc.ones_like</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ones_like(x::Vec{T}; T2::Type{S}=T, prefix::String=x.obj.prefix) -&gt; Vec{S}</code></pre><p>Create a new distributed vector with the same size and partition as <code>x</code>, filled with ones.</p><p><strong>Arguments</strong></p><ul><li><code>x</code>: Template vector to match size and partition</li><li><code>T2</code>: Element type of the result (defaults to same type as <code>x</code>)</li><li><code>prefix</code>: PETSc options prefix (defaults to same prefix as <code>x</code>)</li></ul><p>See also: <a href="#SafePETSc.zeros_like"><code>zeros_like</code></a>, <a href="#SafePETSc.fill_like"><code>fill_like</code></a>, <a href="#SafePETSc.Vec_uniform"><code>Vec_uniform</code></a></p></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SafePETSc.fill_like" href="#SafePETSc.fill_like"><code>SafePETSc.fill_like</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">fill_like(x::Vec{T}, val; T2::Type{S}=typeof(val), prefix::String=x.obj.prefix) -&gt; Vec{S}</code></pre><p>Create a new distributed vector with the same size and partition as <code>x</code>, filled with <code>val</code>.</p><p><strong>Arguments</strong></p><ul><li><code>x</code>: Template vector to match size and partition</li><li><code>val</code>: Value to fill the vector with</li><li><code>T2</code>: Element type of the result (defaults to type of <code>val</code>)</li><li><code>prefix</code>: PETSc options prefix (defaults to same prefix as <code>x</code>)</li></ul><p><strong>Example</strong></p><pre><code class="language-julia hljs">y = fill_like(x, 3.14)  # Create a vector like x, filled with 3.14</code></pre><p>See also: <a href="#SafePETSc.zeros_like"><code>zeros_like</code></a>, <a href="#SafePETSc.ones_like"><code>ones_like</code></a>, <a href="#SafePETSc.Vec_uniform"><code>Vec_uniform</code></a></p></div></section></article><h2 id="Partitioning"><a class="docs-heading-anchor" href="#Partitioning">Partitioning</a><a id="Partitioning-1"></a><a class="docs-heading-anchor-permalink" href="#Partitioning" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SafePETSc.default_row_partition" href="#SafePETSc.default_row_partition"><code>SafePETSc.default_row_partition</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">default_row_partition(n::Int, nranks::Int) -&gt; Vector{Int}</code></pre><p>Create a default row partition that divides n rows equally among nranks.</p><p>Returns a Vector{Int} of length nranks+1 where partition[i] is the start row (1-indexed) for rank i-1.</p></div></section></article><h2 id="Operations"><a class="docs-heading-anchor" href="#Operations">Operations</a><a id="Operations-1"></a><a class="docs-heading-anchor-permalink" href="#Operations" title="Permalink"></a></h2><h3 id="Arithmetic"><a class="docs-heading-anchor" href="#Arithmetic">Arithmetic</a><a id="Arithmetic-1"></a><a class="docs-heading-anchor-permalink" href="#Arithmetic" title="Permalink"></a></h3><p>Vectors support standard Julia arithmetic operations via broadcasting:</p><pre><code class="language-julia hljs">y = x .+ 1.0        # Element-wise addition
y = 2.0 .* x        # Scaling
z = x .+ y          # Vector addition
y .= x .+ 1.0       # In-place operation</code></pre><p>Standard operators are also overloaded:</p><pre><code class="language-julia hljs">z = x + y           # Addition
z = x - y           # Subtraction
z = -x              # Negation</code></pre><h3 id="Linear-Algebra"><a class="docs-heading-anchor" href="#Linear-Algebra">Linear Algebra</a><a id="Linear-Algebra-1"></a><a class="docs-heading-anchor-permalink" href="#Linear-Algebra" title="Permalink"></a></h3><pre><code class="language-julia hljs">y = A * x                              # Matrix-vector multiplication
LinearAlgebra.mul!(y, A, x)            # In-place multiplication
w = v&#39; * A                             # Adjoint-vector times matrix
LinearAlgebra.mul!(w, v&#39;, A)           # In-place</code></pre><h3 id="Properties"><a class="docs-heading-anchor" href="#Properties">Properties</a><a id="Properties-1"></a><a class="docs-heading-anchor-permalink" href="#Properties" title="Permalink"></a></h3><pre><code class="language-julia hljs">T = eltype(v)                          # Element type
n = length(v)                          # Vector length
n = size(v, 1)                         # Size in dimension 1</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../safempi/">« SafeMPI</a><a class="docs-footer-nextpage" href="../matrices/">Matrices »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.15.0 on <span class="colophon-date" title="Thursday 13 November 2025 19:07">Thursday 13 November 2025</span>. Using Julia version 1.12.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
