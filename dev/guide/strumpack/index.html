<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>STRUMPACK Support · SafePETSc.jl 0.1.16</title><meta name="title" content="STRUMPACK Support · SafePETSc.jl 0.1.16"/><meta property="og:title" content="STRUMPACK Support · SafePETSc.jl 0.1.16"/><meta property="twitter:title" content="STRUMPACK Support · SafePETSc.jl 0.1.16"/><meta name="description" content="Documentation for SafePETSc.jl 0.1.16."/><meta property="og:description" content="Documentation for SafePETSc.jl 0.1.16."/><meta property="twitter:description" content="Documentation for SafePETSc.jl 0.1.16."/><meta property="og:url" content="https://sloisel.github.io/SafePETSc.jl/guide/strumpack/"/><meta property="twitter:url" content="https://sloisel.github.io/SafePETSc.jl/guide/strumpack/"/><link rel="canonical" href="https://sloisel.github.io/SafePETSc.jl/guide/strumpack/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">SafePETSc.jl 0.1.16</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../getting_started/">Getting Started</a></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../vectors/">Vectors</a></li><li><a class="tocitem" href="../matrices/">Matrices</a></li><li><a class="tocitem" href="../solvers/">Linear Solvers</a></li><li class="is-active"><a class="tocitem" href>STRUMPACK Support</a><ul class="internal"><li><a class="tocitem" href="#Overview"><span>Overview</span></a></li><li><a class="tocitem" href="#When-to-Use-STRUMPACK"><span>When to Use STRUMPACK</span></a></li><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Verifying-Installation"><span>Verifying Installation</span></a></li><li><a class="tocitem" href="#Using-STRUMPACK"><span>Using STRUMPACK</span></a></li><li><a class="tocitem" href="#GPU-Acceleration"><span>GPU Acceleration</span></a></li><li><a class="tocitem" href="#Performance-Comparison"><span>Performance Comparison</span></a></li><li><a class="tocitem" href="#Rebuilding"><span>Rebuilding</span></a></li><li><a class="tocitem" href="#Troubleshooting"><span>Troubleshooting</span></a></li><li><a class="tocitem" href="#API-Reference"><span>API Reference</span></a></li><li><a class="tocitem" href="#See-Also"><span>See Also</span></a></li></ul></li><li><a class="tocitem" href="../io/">Input/Output and Display</a></li><li><a class="tocitem" href="../mpi_programming/">MPI Programming</a></li><li><a class="tocitem" href="../distributed_refs/">Distributed Reference Management</a></li></ul></li><li><span class="tocitem">API Reference</span><ul><li><a class="tocitem" href="../../api/safempi/">SafeMPI</a></li><li><a class="tocitem" href="../../api/vectors/">Vectors</a></li><li><a class="tocitem" href="../../api/matrices/">Matrices</a></li><li><a class="tocitem" href="../../api/solvers/">Solvers</a></li></ul></li><li><a class="tocitem" href="../../developer/">Developer Guide</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">User Guide</a></li><li class="is-active"><a href>STRUMPACK Support</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>STRUMPACK Support</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="STRUMPACK-Solver-Support"><a class="docs-heading-anchor" href="#STRUMPACK-Solver-Support">STRUMPACK Solver Support</a><a id="STRUMPACK-Solver-Support-1"></a><a class="docs-heading-anchor-permalink" href="#STRUMPACK-Solver-Support" title="Permalink"></a></h1><p>SafePETSc supports both MUMPS (default) and STRUMPACK as sparse direct solvers. STRUMPACK offers GPU acceleration and better MPI scalability for large-scale problems.</p><h2 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h2><table><tr><th style="text-align: right">Feature</th><th style="text-align: right">MUMPS (Default)</th><th style="text-align: right">STRUMPACK</th></tr><tr><td style="text-align: right">Included in PETSc_jll</td><td style="text-align: right">Yes</td><td style="text-align: right">No (requires build)</td></tr><tr><td style="text-align: right">GPU Acceleration</td><td style="text-align: right">Limited</td><td style="text-align: right">CUDA, HIP, SYCL</td></tr><tr><td style="text-align: right">MPI Scalability</td><td style="text-align: right">Good</td><td style="text-align: right">Better</td></tr><tr><td style="text-align: right">Compression</td><td style="text-align: right">BLR</td><td style="text-align: right">BLR, HSS, HODLR</td></tr><tr><td style="text-align: right">Setup</td><td style="text-align: right">None</td><td style="text-align: right">One-time build</td></tr></table><h2 id="When-to-Use-STRUMPACK"><a class="docs-heading-anchor" href="#When-to-Use-STRUMPACK">When to Use STRUMPACK</a><a id="When-to-Use-STRUMPACK-1"></a><a class="docs-heading-anchor-permalink" href="#When-to-Use-STRUMPACK" title="Permalink"></a></h2><p>Consider STRUMPACK when:</p><ul><li>You have access to GPUs (NVIDIA, AMD, or Intel)</li><li>Your problems are large and MPI scalability matters</li><li>You want to use low-rank compression (BLR, HSS) to reduce memory</li><li>You&#39;re running on HPC clusters</li></ul><p>Stick with MUMPS when:</p><ul><li>You want zero setup (just <code>using SafePETSc</code>)</li><li>You&#39;re developing locally without GPUs</li><li>Your problems are small to medium sized</li></ul><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><h3 id="Prerequisites"><a class="docs-heading-anchor" href="#Prerequisites">Prerequisites</a><a id="Prerequisites-1"></a><a class="docs-heading-anchor-permalink" href="#Prerequisites" title="Permalink"></a></h3><p><strong>System MPI is required.</strong> The JLL-provided MPI wrappers have broken paths and cannot be used for building PETSc from source.</p><pre><code class="language-bash hljs"># macOS
brew install open-mpi

# Ubuntu/Debian
sudo apt-get install libopenmpi-dev</code></pre><p>Then configure MPI.jl to use system MPI:</p><pre><code class="language-julia hljs">using MPIPreferences

# On macOS (Open MPI from Homebrew)
MPIPreferences.use_system_binary(;
    library_names=[&quot;libmpi&quot;],
    extra_paths=[&quot;/opt/homebrew/Cellar/open-mpi/5.0.8/lib&quot;],  # Adjust version as needed
    mpiexec=&quot;/opt/homebrew/bin/mpiexec&quot;
)

# On Linux (usually auto-detects)
MPIPreferences.use_system_binary()

# Restart Julia after configuring</code></pre><p><strong>Important</strong>: MPI.jl must use the <strong>same MPI implementation</strong> as the PETSc build. If PETSc is built with Open MPI, MPI.jl must also use Open MPI. Mixing Open MPI and MPICH causes crashes.</p><h3 id="One-Time-Build"><a class="docs-heading-anchor" href="#One-Time-Build">One-Time Build</a><a id="One-Time-Build-1"></a><a class="docs-heading-anchor-permalink" href="#One-Time-Build" title="Permalink"></a></h3><p>STRUMPACK requires building PETSc from source with both STRUMPACK and MUMPS enabled:</p><pre><code class="language-julia hljs">using SafePETSc

# CPU-only build (works on macOS and Linux)
SafePETSc.build_petsc_strumpack()

# Build with GPU support (Linux only, requires SDK installed)
SafePETSc.build_petsc_strumpack(with_cuda=true)   # NVIDIA GPUs
SafePETSc.build_petsc_strumpack(with_hip=true)    # AMD GPUs
SafePETSc.build_petsc_strumpack(with_sycl=true)   # Intel GPUs</code></pre><p><strong>GPU Build Requirements</strong> (Linux only): | GPU | Parameter | SDK Required | |––-|–––––-|–––––––| | NVIDIA | <code>with_cuda=true</code> | CUDA Toolkit (<code>nvcc</code>) | | AMD | <code>with_hip=true</code> | ROCm (<code>hipcc</code>) | | Intel | <code>with_sycl=true</code> | oneAPI (<code>icpx</code>) |</p><p>GPU SDKs are not available on macOS. The CPU-only build still provides STRUMPACK&#39;s compression features and MPI scalability benefits.</p><p>The build function will:</p><ol><li>Download PETSc source code</li><li>Compile with STRUMPACK, MUMPS, and dependencies (METIS, ParMETIS, ScaLAPACK)</li><li>Add GPU support if requested and SDK is available</li><li>Cache the build in Julia&#39;s scratch space</li><li>Offer to configure your <code>startup.jl</code> automatically</li></ol><h3 id="Post-Build-Setup"><a class="docs-heading-anchor" href="#Post-Build-Setup">Post-Build Setup</a><a id="Post-Build-Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Post-Build-Setup" title="Permalink"></a></h3><p>After building, you need to set the <code>JULIA_PETSC_LIBRARY</code> environment variable <strong>before PETSc.jl is loaded</strong>. This is because PETSc.jl selects the library at precompile time using <code>@static if</code>.</p><p>The build function offers to do this automatically by modifying <code>~/.julia/config/startup.jl</code>.</p><p>If you prefer manual setup, add this to your <code>startup.jl</code>:</p><pre><code class="language-julia hljs">ENV[&quot;JULIA_PETSC_LIBRARY&quot;] = &quot;/path/to/libpetsc.dylib&quot;  # or .so on Linux</code></pre><p>Get the path with:</p><pre><code class="language-julia hljs">julia&gt; SafePETSc.petsc_strumpack_library_path()</code></pre><p>Then:</p><ol><li>Restart Julia</li><li>Delete PETSc&#39;s compiled cache to force recompilation with the new library:<pre><code class="language-bash hljs">rm -rf ~/.julia/compiled/v1.*/PETSc ~/.julia/compiled/v1.*/SafePETSc</code></pre></li><li>Start Julia again - PETSc will recompile with the STRUMPACK library</li></ol><h3 id="HPC-Clusters"><a class="docs-heading-anchor" href="#HPC-Clusters">HPC Clusters</a><a id="HPC-Clusters-1"></a><a class="docs-heading-anchor-permalink" href="#HPC-Clusters" title="Permalink"></a></h3><p>On clusters with non-shared home directories, either:</p><ol><li>Build to a shared location (with GPU support if available):</li></ol><pre><code class="language-julia hljs"># On NVIDIA GPU cluster
SafePETSc.build_petsc_strumpack(install_dir=&quot;/software/petsc-strumpack&quot;, with_cuda=true)

# On AMD GPU cluster
SafePETSc.build_petsc_strumpack(install_dir=&quot;/software/petsc-strumpack&quot;, with_hip=true)</code></pre><ol><li>Or set the environment variable in your job script:</li></ol><pre><code class="language-bash hljs">export JULIA_PETSC_LIBRARY=&quot;/path/to/libpetsc.so&quot;</code></pre><h2 id="Verifying-Installation"><a class="docs-heading-anchor" href="#Verifying-Installation">Verifying Installation</a><a id="Verifying-Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Verifying-Installation" title="Permalink"></a></h2><p>Check if STRUMPACK build is available:</p><pre><code class="language-julia hljs">using SafePETSc

if SafePETSc.petsc_strumpack_available()
    println(&quot;STRUMPACK build found at: &quot;, SafePETSc.petsc_strumpack_library_path())
else
    println(&quot;STRUMPACK build not found, using default PETSc_jll (MUMPS)&quot;)
end</code></pre><h2 id="Using-STRUMPACK"><a class="docs-heading-anchor" href="#Using-STRUMPACK">Using STRUMPACK</a><a id="Using-STRUMPACK-1"></a><a class="docs-heading-anchor-permalink" href="#Using-STRUMPACK" title="Permalink"></a></h2><h3 id="Automatic-Configuration"><a class="docs-heading-anchor" href="#Automatic-Configuration">Automatic Configuration</a><a id="Automatic-Configuration-1"></a><a class="docs-heading-anchor-permalink" href="#Automatic-Configuration" title="Permalink"></a></h3><p>When <code>JULIA_PETSC_LIBRARY</code> points to a STRUMPACK-enabled build, <code>SafePETSc.Init()</code> automatically configures STRUMPACK as the default direct solver. No additional options are needed:</p><pre><code class="language-julia hljs">using SafePETSc
SafePETSc.Init()

# STRUMPACK is automatically used for direct solves
x = A \ b</code></pre><h3 id="Manual-Configuration"><a class="docs-heading-anchor" href="#Manual-Configuration">Manual Configuration</a><a id="Manual-Configuration-1"></a><a class="docs-heading-anchor-permalink" href="#Manual-Configuration" title="Permalink"></a></h3><p>If you want to explicitly control the solver, use PETSc options with the <code>MPIAIJ_</code> prefix for sparse matrices:</p><pre><code class="language-julia hljs">using SafePETSc
SafePETSc.Init()

# Explicitly request LU factorization with STRUMPACK for sparse matrices
petsc_options_insert_string(&quot;-MPIAIJ_pc_type lu -MPIAIJ_pc_factor_mat_solver_type strumpack&quot;)

# Solve as usual
x = A \ b</code></pre><p><strong>Note</strong>: STRUMPACK is designed for sparse direct solves and is only configured for <code>MPIAIJ</code> matrices. Dense matrices (<code>MPIDENSE</code>) use different solvers.</p><p>SafePETSc uses prefixed options (<code>MPIAIJ_</code>, <code>MPIDENSE_</code>) for all matrices. Unprefixed options like <code>-pc_type</code> will be ignored.</p><h3 id="STRUMPACK-Options"><a class="docs-heading-anchor" href="#STRUMPACK-Options">STRUMPACK Options</a><a id="STRUMPACK-Options-1"></a><a class="docs-heading-anchor-permalink" href="#STRUMPACK-Options" title="Permalink"></a></h3><p>Configure STRUMPACK behavior with these PETSc options:</p><pre><code class="language-julia hljs"># Compression type (BLR recommended for most cases)
petsc_options_insert_string(&quot;-mat_strumpack_compression BLR&quot;)

# GPU acceleration (requires GPU-enabled build)
petsc_options_insert_string(&quot;-mat_strumpack_gpu&quot;)

# Verbose output for debugging
petsc_options_insert_string(&quot;-mat_strumpack_verbose&quot;)

# Compression tolerance (for approximate solvers)
petsc_options_insert_string(&quot;-mat_strumpack_compression_rel_tol 1e-4&quot;)</code></pre><h3 id="Compression-Types"><a class="docs-heading-anchor" href="#Compression-Types">Compression Types</a><a id="Compression-Types-1"></a><a class="docs-heading-anchor-permalink" href="#Compression-Types" title="Permalink"></a></h3><table><tr><th style="text-align: right">Type</th><th style="text-align: right">Description</th><th style="text-align: right">Use Case</th></tr><tr><td style="text-align: right"><code>NONE</code></td><td style="text-align: right">No compression (exact)</td><td style="text-align: right">Small problems, maximum accuracy</td></tr><tr><td style="text-align: right"><code>BLR</code></td><td style="text-align: right">Block Low Rank</td><td style="text-align: right">General purpose, good default</td></tr><tr><td style="text-align: right"><code>HSS</code></td><td style="text-align: right">Hierarchically Semi-Separable</td><td style="text-align: right">Structured matrices</td></tr><tr><td style="text-align: right"><code>HODLR</code></td><td style="text-align: right">Hierarchically Off-Diagonal Low Rank</td><td style="text-align: right">Requires ButterflyPACK</td></tr></table><p>BLR is recommended as it works well without additional dependencies.</p><h2 id="GPU-Acceleration"><a class="docs-heading-anchor" href="#GPU-Acceleration">GPU Acceleration</a><a id="GPU-Acceleration-1"></a><a class="docs-heading-anchor-permalink" href="#GPU-Acceleration" title="Permalink"></a></h2><p>STRUMPACK supports multiple GPU backends:</p><table><tr><th style="text-align: right">Backend</th><th style="text-align: right">Hardware</th><th style="text-align: right">Libraries</th></tr><tr><td style="text-align: right">CUDA</td><td style="text-align: right">NVIDIA GPUs</td><td style="text-align: right">cuBLAS, cuSOLVER</td></tr><tr><td style="text-align: right">HIP</td><td style="text-align: right">AMD GPUs</td><td style="text-align: right">rocBLAS, rocSOLVER</td></tr><tr><td style="text-align: right">SYCL</td><td style="text-align: right">Intel GPUs</td><td style="text-align: right">oneMKL</td></tr></table><p>Enable GPU acceleration:</p><pre><code class="language-julia hljs">petsc_options_insert_string(&quot;-mat_strumpack_gpu&quot;)</code></pre><p><strong>Important</strong>: For multi-GPU setups, use 1 MPI process per GPU.</p><h3 id="GPU-Notes"><a class="docs-heading-anchor" href="#GPU-Notes">GPU Notes</a><a id="GPU-Notes-1"></a><a class="docs-heading-anchor-permalink" href="#GPU-Notes" title="Permalink"></a></h3><ul><li>STRUMPACK handles GPU memory management internally</li><li>Input matrices and vectors stay on CPU</li><li>GPU is used for numerical factorization</li><li>No GPU-native matrix types needed (standard MPIAIJ works)</li></ul><h2 id="Performance-Comparison"><a class="docs-heading-anchor" href="#Performance-Comparison">Performance Comparison</a><a id="Performance-Comparison-1"></a><a class="docs-heading-anchor-permalink" href="#Performance-Comparison" title="Permalink"></a></h2><p>Typical speedups with STRUMPACK GPU:</p><table><tr><th style="text-align: right">Problem Size</th><th style="text-align: right">CPU Only</th><th style="text-align: right">GPU (BLR)</th><th style="text-align: right">Speedup</th></tr><tr><td style="text-align: right">Small</td><td style="text-align: right">1x</td><td style="text-align: right">0.8x</td><td style="text-align: right">Overhead</td></tr><tr><td style="text-align: right">Medium</td><td style="text-align: right">1x</td><td style="text-align: right">3-5x</td><td style="text-align: right">Good</td></tr><tr><td style="text-align: right">Large</td><td style="text-align: right">1x</td><td style="text-align: right">6-14x</td><td style="text-align: right">Excellent</td></tr></table><p>GPU acceleration is most beneficial for larger problems where factorization dominates.</p><h2 id="Rebuilding"><a class="docs-heading-anchor" href="#Rebuilding">Rebuilding</a><a id="Rebuilding-1"></a><a class="docs-heading-anchor-permalink" href="#Rebuilding" title="Permalink"></a></h2><p>To rebuild with different options:</p><pre><code class="language-julia hljs"># Force rebuild
SafePETSc.build_petsc_strumpack(rebuild=true)

# Build with debugging symbols
SafePETSc.build_petsc_strumpack(rebuild=true, with_debugging=true)

# Build to custom location
SafePETSc.build_petsc_strumpack(install_dir=&quot;/custom/path&quot;)</code></pre><h2 id="Troubleshooting"><a class="docs-heading-anchor" href="#Troubleshooting">Troubleshooting</a><a id="Troubleshooting-1"></a><a class="docs-heading-anchor-permalink" href="#Troubleshooting" title="Permalink"></a></h2><h3 id="Build-Failures"><a class="docs-heading-anchor" href="#Build-Failures">Build Failures</a><a id="Build-Failures-1"></a><a class="docs-heading-anchor-permalink" href="#Build-Failures" title="Permalink"></a></h3><p><strong>Missing compilers</strong>: Ensure you have C, C++, and optionally Fortran compilers:</p><pre><code class="language-bash hljs"># macOS
xcode-select --install
brew install gcc

# Ubuntu/Debian
sudo apt-get install build-essential gfortran cmake</code></pre><p><strong>Missing MPI</strong>: The build requires system MPI (not the JLL wrappers). Install it and configure MPI.jl:</p><pre><code class="language-bash hljs"># macOS
brew install open-mpi

# Ubuntu/Debian
sudo apt-get install libopenmpi-dev</code></pre><pre><code class="language-julia hljs">using MPIPreferences
MPIPreferences.use_system_binary()
# Restart Julia</code></pre><h3 id="Runtime-Issues"><a class="docs-heading-anchor" href="#Runtime-Issues">Runtime Issues</a><a id="Runtime-Issues-1"></a><a class="docs-heading-anchor-permalink" href="#Runtime-Issues" title="Permalink"></a></h3><p><strong>&quot;STRUMPACK not found&quot;</strong>: Ensure <code>JULIA_PETSC_LIBRARY</code> is set in <code>startup.jl</code> and:</p><ol><li>Julia was restarted</li><li>PETSc&#39;s compiled cache was deleted (<code>rm -rf ~/.julia/compiled/v1.*/PETSc</code>)</li></ol><p><strong>MPI mismatch error</strong> (&quot;Application was linked against both Open MPI and MPICH&quot;): This means MPI.jl is using a different MPI implementation than PETSc was built with. Check which MPI you have:</p><pre><code class="language-julia hljs">using MPI
MPI.identify_implementation()  # Should match what PETSc was built with</code></pre><p>The STRUMPACK build uses system MPI (usually Open MPI from Homebrew). Configure MPI.jl to match:</p><pre><code class="language-julia hljs">using MPIPreferences
# On macOS with Homebrew Open MPI:
MPIPreferences.use_system_binary(;
    library_names=[&quot;libmpi&quot;],
    extra_paths=[&quot;/opt/homebrew/Cellar/open-mpi/5.0.8/lib&quot;],
    mpiexec=&quot;/opt/homebrew/bin/mpiexec&quot;
)
# Then restart Julia and delete compiled caches</code></pre><p><strong>Slow performance</strong>:</p><ul><li>Check GPU is actually being used: <code>-mat_strumpack_verbose</code></li><li>Ensure 1 MPI rank per GPU for multi-GPU</li><li>Try BLR compression for memory-bound problems</li></ul><p><strong>Convergence issues with BLR</strong>:</p><ul><li>Reduce compression tolerance: <code>-mat_strumpack_compression_rel_tol 1e-6</code></li><li>Or disable compression: <code>-mat_strumpack_compression NONE</code></li></ul><h2 id="API-Reference"><a class="docs-heading-anchor" href="#API-Reference">API Reference</a><a id="API-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#API-Reference" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="SafePETSc.build_petsc_strumpack"><a class="docstring-binding" href="#SafePETSc.build_petsc_strumpack"><code>SafePETSc.build_petsc_strumpack</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">build_petsc_strumpack(;
    install_dir::Union{String,Nothing}=nothing,
    rebuild::Bool=false,
    with_debugging::Bool=false,
    with_cuda::Bool=false,
    with_hip::Bool=false,
    with_sycl::Bool=false,
    verbose::Bool=true
) -&gt; String</code></pre><p>Download and build PETSc with both STRUMPACK and MUMPS solvers.</p><p>This function downloads PETSc source code and compiles it with both solvers enabled, giving users the choice of direct solver. The build is cached, so subsequent calls will skip the build if the library already exists (unless <code>rebuild=true</code>).</p><p><strong>Prerequisites</strong></p><p><strong>System MPI is required.</strong> The JLL-provided MPI wrappers have broken paths.</p><pre><code class="language-bash hljs"># macOS
brew install open-mpi

# Ubuntu/Debian
sudo apt-get install libopenmpi-dev</code></pre><p>Then configure MPI.jl to use system MPI:</p><pre><code class="language-julia hljs">using MPIPreferences
MPIPreferences.use_system_binary()
# Restart Julia</code></pre><p><strong>Arguments</strong></p><ul><li><code>install_dir</code>: Custom installation directory. If <code>nothing</code>, uses Julia&#39;s Scratch.jl managed directory (recommended for most users).</li><li><code>rebuild</code>: Force rebuild even if library already exists.</li><li><code>with_debugging</code>: Build with debugging symbols (slower but useful for development).</li><li><code>with_cuda</code>: Enable NVIDIA GPU support (requires CUDA Toolkit, Linux only).</li><li><code>with_hip</code>: Enable AMD GPU support (requires ROCm, Linux only).</li><li><code>with_sycl</code>: Enable Intel GPU support (requires oneAPI, Linux only).</li><li><code>verbose</code>: Print progress messages during build.</li></ul><p><strong>Returns</strong></p><p>The path to the built PETSc library.</p><p><strong>Build Time</strong></p><p>First build typically takes 30-60 minutes depending on your system.</p><p><strong>Post-Build Setup</strong></p><p>After building, you need to set the <code>JULIA_PETSC_LIBRARY</code> environment variable and restart Julia. The function will offer to set this up automatically.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">using SafePETSc

# CPU-only build (works everywhere)
SafePETSc.build_petsc_strumpack()

# Build with NVIDIA GPU support (Linux only)
SafePETSc.build_petsc_strumpack(with_cuda=true)

# Build with AMD GPU support (Linux only)
SafePETSc.build_petsc_strumpack(with_hip=true)

# Follow the prompts to configure your startup.jl, then restart Julia</code></pre><p><strong>Solver Selection</strong></p><p>After setup, choose your solver via PETSc options:</p><pre><code class="language-julia hljs"># STRUMPACK (GPU acceleration, better MPI scalability)
petsc_options_insert_string(&quot;-pc_factor_mat_solver_type strumpack&quot;)
petsc_options_insert_string(&quot;-mat_strumpack_compression BLR&quot;)
petsc_options_insert_string(&quot;-mat_strumpack_gpu&quot;)  # Enable GPU if built with GPU support

# MUMPS (proven direct solver)
petsc_options_insert_string(&quot;-pc_factor_mat_solver_type mumps&quot;)</code></pre><p><strong>HPC Clusters</strong></p><p>On clusters with non-shared home directories, specify a shared location:</p><pre><code class="language-julia hljs">SafePETSc.build_petsc_strumpack(install_dir=&quot;/software/petsc-strumpack&quot;, with_cuda=true)</code></pre><p>Then set <code>JULIA_PETSC_LIBRARY</code> in your job submission script or module file.</p><p>See also: <a href="#SafePETSc.petsc_strumpack_library_path"><code>petsc_strumpack_library_path</code></a>, <a href="#SafePETSc.petsc_strumpack_available"><code>petsc_strumpack_available</code></a></p></div></section></details></article><article><details class="docstring" open="true"><summary id="SafePETSc.petsc_strumpack_library_path"><a class="docstring-binding" href="#SafePETSc.petsc_strumpack_library_path"><code>SafePETSc.petsc_strumpack_library_path</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">petsc_strumpack_library_path() -&gt; String</code></pre><p>Return the path to the STRUMPACK-enabled PETSc library in the scratch directory.</p><p>This path is consistent across Julia sessions and can be used to set <code>JULIA_PETSC_LIBRARY</code> in your startup.jl file.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">lib_path = petsc_strumpack_library_path()
# Returns something like: ~/.julia/scratchspaces/uuid/petsc_strumpack/lib/libpetsc.dylib</code></pre></div></section></details></article><article><details class="docstring" open="true"><summary id="SafePETSc.petsc_strumpack_available"><a class="docstring-binding" href="#SafePETSc.petsc_strumpack_available"><code>SafePETSc.petsc_strumpack_available</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">petsc_strumpack_available() -&gt; Bool</code></pre><p>Check if a STRUMPACK-enabled PETSc build is available in the scratch directory.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">if petsc_strumpack_available()
    println(&quot;STRUMPACK build found at: &quot;, petsc_strumpack_library_path())
end</code></pre></div></section></details></article><h2 id="See-Also"><a class="docs-heading-anchor" href="#See-Also">See Also</a><a id="See-Also-1"></a><a class="docs-heading-anchor-permalink" href="#See-Also" title="Permalink"></a></h2><ul><li><a href="../solvers/#Linear-Solvers">Linear Solvers</a> - General solver documentation</li><li><a href="https://petsc.org/release/manualpages/Mat/MATSOLVERSTRUMPACK/">PETSc STRUMPACK Documentation</a></li><li><a href="https://github.com/pghysels/STRUMPACK">STRUMPACK GitHub</a></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../solvers/">« Linear Solvers</a><a class="docs-footer-nextpage" href="../io/">Input/Output and Display »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Wednesday 26 November 2025 20:39">Wednesday 26 November 2025</span>. Using Julia version 1.12.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
